"use strict";(()=>{var J=Object.create;var k=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var $=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var R=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var H=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of W(r))!Q.call(e,s)&&s!==t&&k(e,s,{get:()=>r[s],enumerable:!(o=G(r,s))||o.enumerable});return e};var M=(e,r,t)=>(t=e!=null?J(z(e)):{},H(r||!e||!e.__esModule?k(t,"default",{value:e,enumerable:!0}):t,e));var C=R((he,X)=>{X.exports={name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var q=R((ye,w)=>{"use strict";var V=$("fs"),j=$("path"),Z=$("os"),ee=$("crypto"),te=C(),T=te.version,re=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function ne(e){let r={},t=e.toString();t=t.replace(/\r\n?/mg,`
`);let o;for(;(o=re.exec(t))!=null;){let s=o[1],n=o[2]||"";n=n.trim();let c=n[0];n=n.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),c==='"'&&(n=n.replace(/\\n/g,`
`),n=n.replace(/\\r/g,"\r")),r[s]=n}return r}function oe(e){e=e||{};let r=Y(e);e.path=r;let t=u.configDotenv(e);if(!t.parsed){let c=new Error(`MISSING_DATA: Cannot parse ${r} for an unknown reason`);throw c.code="MISSING_DATA",c}let o=K(e).split(","),s=o.length,n;for(let c=0;c<s;c++)try{let i=o[c].trim(),h=se(t,i);n=u.decrypt(h.ciphertext,h.key);break}catch(i){if(c+1>=s)throw i}return u.parse(n)}function ie(e){console.log(`[dotenv@${T}][WARN] ${e}`)}function I(e){console.log(`[dotenv@${T}][DEBUG] ${e}`)}function P(e){console.log(`[dotenv@${T}] ${e}`)}function K(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function se(e,r){let t;try{t=new URL(r)}catch(i){if(i.code==="ERR_INVALID_URL"){let h=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw h.code="INVALID_DOTENV_KEY",h}throw i}let o=t.password;if(!o){let i=new Error("INVALID_DOTENV_KEY: Missing key part");throw i.code="INVALID_DOTENV_KEY",i}let s=t.searchParams.get("environment");if(!s){let i=new Error("INVALID_DOTENV_KEY: Missing environment part");throw i.code="INVALID_DOTENV_KEY",i}let n=`DOTENV_VAULT_${s.toUpperCase()}`,c=e.parsed[n];if(!c){let i=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${n} in your .env.vault file.`);throw i.code="NOT_FOUND_DOTENV_ENVIRONMENT",i}return{ciphertext:c,key:o}}function Y(e){let r=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(let t of e.path)V.existsSync(t)&&(r=t.endsWith(".vault")?t:`${t}.vault`);else r=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else r=j.resolve(process.cwd(),".env.vault");return V.existsSync(r)?r:null}function A(e){return e[0]==="~"?j.join(Z.homedir(),e.slice(1)):e}function ae(e){let r=!!(e&&e.debug),t=e&&"quiet"in e?e.quiet:!0;(r||!t)&&P("Loading env from encrypted .env.vault");let o=u._parseVault(e),s=process.env;return e&&e.processEnv!=null&&(s=e.processEnv),u.populate(s,o,e),{parsed:o}}function ce(e){let r=j.resolve(process.cwd(),".env"),t="utf8",o=!!(e&&e.debug),s=e&&"quiet"in e?e.quiet:!0;e&&e.encoding?t=e.encoding:o&&I("No encoding is specified. UTF-8 is used by default");let n=[r];if(e&&e.path)if(!Array.isArray(e.path))n=[A(e.path)];else{n=[];for(let E of e.path)n.push(A(E))}let c,i={};for(let E of n)try{let d=u.parse(V.readFileSync(E,{encoding:t}));u.populate(i,d,e)}catch(d){o&&I(`Failed to load ${E} ${d.message}`),c=d}let h=process.env;if(e&&e.processEnv!=null&&(h=e.processEnv),u.populate(h,i,e),o||!s){let E=Object.keys(i).length,d=[];for(let N of n)try{let f=j.relative(process.cwd(),N);d.push(f)}catch(f){o&&I(`Failed to load ${N} ${f.message}`),c=f}P(`injecting env (${E}) from ${d.join(",")}`)}return c?{parsed:i,error:c}:{parsed:i}}function le(e){if(K(e).length===0)return u.configDotenv(e);let r=Y(e);return r?u._configVault(e):(ie(`You set DOTENV_KEY but you are missing a .env.vault file at ${r}. Did you forget to build it?`),u.configDotenv(e))}function de(e,r){let t=Buffer.from(r.slice(-64),"hex"),o=Buffer.from(e,"base64"),s=o.subarray(0,12),n=o.subarray(-16);o=o.subarray(12,-16);try{let c=ee.createDecipheriv("aes-256-gcm",t,s);return c.setAuthTag(n),`${c.update(o)}${c.final()}`}catch(c){let i=c instanceof RangeError,h=c.message==="Invalid key length",E=c.message==="Unsupported state or unable to authenticate data";if(i||h){let d=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw d.code="INVALID_DOTENV_KEY",d}else if(E){let d=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw d.code="DECRYPTION_FAILED",d}else throw c}}function me(e,r,t={}){let o=!!(t&&t.debug),s=!!(t&&t.override);if(typeof r!="object"){let n=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw n.code="OBJECT_REQUIRED",n}for(let n of Object.keys(r))Object.prototype.hasOwnProperty.call(e,n)?(s===!0&&(e[n]=r[n]),o&&I(s===!0?`"${n}" is already defined and WAS overwritten`:`"${n}" is already defined and was NOT overwritten`)):e[n]=r[n]}var u={configDotenv:ce,_configVault:ae,_parseVault:oe,config:le,decrypt:de,parse:ne,populate:me};w.exports.configDotenv=u.configDotenv;w.exports._configVault=u._configVault;w.exports._parseVault=u._parseVault;w.exports.config=u.config;w.exports.decrypt=u.decrypt;w.exports.parse=u.parse;w.exports.populate=u.populate;w.exports=u});var g=M($("path")),F=M($("child_process")),v=M($("fs")),L=M($("os")),U=$("url"),B=M(q());B.config();function pe(e,r){let{tableOnly:t=!1,ignoreEnums:o=!1,includeRelationFromFields:s=!1,disableEmoji:n=!1}=r??{},c="erDiagram",i=e.models.concat(e.types),h=t||o?"":e.enums.map(p=>`
        ${p.dbName||p.name} {
            ${p.values.map(l=>`${l.name||l.dbName} ${l.dbName||l.name}`).join(`
`)}
        }
    `).join(`

`),E=n?'"PK"':'"\u{1F5DD}\uFE0F"',d=n?'"nullable"':'"\u2753"',N=i.map(p=>`  "${p.dbName||p.name}" {
${t?"":p.fields.filter(fe(p,s)).map(l=>`    ${l.type.trimStart()} ${l.name.replace(/^_/,"z_")} ${l.isId||p.primaryKey?.fields?.includes(l.name)?E:""}${l.isRequired?"":d}`).join(`
`)}
    }
  `).join(`

`),f="";for(let p of i)for(let l of p.fields){let S=l.kind==="enum";if(S&&(t||o))continue;let O=`${S?"enum:":""}${l.name}`,x=`"${p.dbName||p.name}"`,b=`"${i.find(m=>m.name===l.type)?.dbName||l.type}"`;if(l.relationFromFields&&l.relationFromFields.length>0||S){let m="||";l.isList?m="}o":l.isRequired||(m="|o");let a=i.find(D=>D.name===b),y=a?.fields.find(({relationName:D})=>D===l.relationName),_=m;y?.isList?m="o{":y?.isRequired||(m="o|"),f+=`    ${x} ${m}--${_} ${a?.dbName||b} : "${O}"
`}else if(i.find(m=>m.name===l.type||m.dbName===l.type)&&l.relationFromFields?.length===0){let m=i.find(a=>a.name===l.type||a.dbName===l.type);if(m){let a=i.indexOf(p),y=i.indexOf(m);a<y&&(f+=`    ${x} o{--}o ${b} : ""
`)}}else if(l.kind==="object"){let m=e.types.find(a=>a.name.replace(/^_/,"z_").replace(/\s/g,""));if(console.log(b,m),m){let a="||";l.isList?a="}o":l.isRequired||(a="|o");let y=m?.fields.find(({relationName:D})=>D===l.relationName),_=a;y?.isList?a="o{":y?.isRequired||(a="o|"),f+=`    ${x} ${a}--${_} ${m.dbName||b} : "${O}"
`}}}return`${c}
${h}
${N}
${f}`}var fe=(e,r)=>t=>r?t.kind!=="object":t.kind!=="object"&&!e.fields.find(({relationFromFields:o})=>o?.includes(t.name)),ue=(e,r)=>{let t=r?.split(`
`).filter(o=>o.includes("@map")||o.includes("model ")).map(o=>o.trim());return e.map(o=>({...o,fields:o.fields.map(s=>{let n="None",c=t.filter(i=>(n==="Match"&&i.includes("model ")&&(n="End"),n==="None"&&i.includes(`model ${o.name} `)&&(n="Match"),n==="Match")).find(i=>i.includes(`${s.name} `)&&i.includes("@map"));if(c){let h=new RegExp(/@map\(\"(.*?)\"\)/,"g").exec(c);if(h?.[1]){let E=h[1].replace(/^_/,"z_").replace(/\s/g,"");s.name=E}}return s})}))},ve=async e=>{try{let r=e.generator.output?.value||"./prisma/ERD.svg",t=e.generator.config,o=t.theme??"forest",s=g.resolve(g.join(t.mmdcPath||"node_modules/.bin","mmdc")),n=t.tableOnly==="true",c=t.disableEmoji==="true",i=t.ignoreEnums==="true",h=t.includeRelationFromFields==="true",E=process.env.DISABLE_ERD==="true"||t.disabled==="true",d=t.erdDebug==="true"||!!process.env.ERD_DEBUG;if(d&&(console.log("debug mode enabled"),console.log("config",t)),E)return console.log("ERD generator is disabled");let N=v.default.mkdtempSync(`${L.default.tmpdir()+g.sep}prisma-erd-`);if(!e.dmmf?.datamodel)throw new Error("Datamodel is missing from generator options");let f=JSON.parse(JSON.stringify(e.dmmf.datamodel));if(d&&f){v.default.mkdirSync(g.resolve("prisma/debug"),{recursive:!0});let a=g.resolve("prisma/debug/1-datamodel.json");v.default.writeFileSync(a,JSON.stringify(f,null,2)),console.log(`data model written to ${a}`)}if(f.models=ue(f.models,e.datamodel),f.types||(f.types=[]),d&&f.models){let a=g.resolve("prisma/debug/2-datamodel-map-applied.json");v.default.writeFileSync(a,JSON.stringify(f,null,2)),console.log(`applied @map to fields written to ${a}`)}let p=pe(f,{tableOnly:n,ignoreEnums:i,includeRelationFromFields:h,disableEmoji:c});if(d&&p){let a=g.resolve("prisma/debug/3-mermaid.mmd");v.default.writeFileSync(a,p),console.log(`mermaid written to ${a}`)}if(!p)throw new Error("failed to construct mermaid instance from dml");if(r.endsWith(".md"))return v.default.writeFileSync(r,`\`\`\`mermaid
${p}\`\`\`
`);let l=g.resolve(g.join(N,"prisma.mmd"));v.default.writeFileSync(l,p);let S={deterministicIds:!0,maxTextSize:9e4,er:{useMaxWidth:!0},theme:o},O=S;if(t?.mermaidConfig){let a=g.resolve(t.mermaidConfig),y=await import((0,U.pathToFileURL)(a).href);d&&console.log("imported mermaid config: ",y),O={...S,...y}}let x=g.resolve(g.join(N,"config.json"));v.default.writeFileSync(x,JSON.stringify(O));let b=t.puppeteerConfig;if(b&&!v.default.existsSync(b))throw new Error(`Puppeteer config file "${b}" does not exist`);if(!b){let a=g.resolve(g.join(N,"puppeteerConfig.json")),y,_={logLevel:d?"warn":"error",executablePath:y};if(L.default.platform()==="darwin"&&L.default.arch()==="arm64")try{let D=F.execSync("which chromium").toString().replace(`
`,"");if(!D)throw new Error("Could not find chromium executable. Refer to https://github.com/keonik/prisma-erd-generator#issues for next steps.");_.executablePath=D,_.args=["--no-sandbox"]}catch(D){console.error(D),console.log(`
Prisma ERD Generator: Unable to find chromium path for you MacOS arm64 machine. Attempting to use the default at ${y}. To learn more visit https://github.com/keonik/prisma-erd-generator#-arm64-users-
`),y="/usr/bin/chromium-browser"}v.default.writeFileSync(a,JSON.stringify(_)),b=a}if(t.mmdcPath){if(!v.default.existsSync(s))throw new Error(`
Mermaid CLI provided path does not exist. 
${s}`)}else if(!v.default.existsSync(s)){let a=F.execSync("find ../.. -name mmdc").toString().split(`
`).filter(y=>y).pop();if(!a||!v.default.existsSync(a))throw new Error(`Expected mermaid CLI at 
${s}

or
${a}
 but this package was not found.`);s=g.resolve(a)}let m=`"${s}" -i "${l}" -o "${r}" -c "${x}" -p "${b}"`;if(d&&m&&console.log("mermaid command: ",m),F.execSync(m),!v.default.existsSync(r))throw new Error(`Issue generating ER Diagram. Expected ${r} to be created`)}catch(r){throw console.error(r),r}};})();
